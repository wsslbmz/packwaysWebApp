/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { debounceTime } from 'rxjs/operators';
import { Component, EventEmitter, Input, NgZone, Output, ViewChild } from '@angular/core';
import { AutocompleteGroup } from '../classes/AutocompleteGroup';
import { ComparableAutoCompleteString, SearchableAutoCompleteString } from '../classes/AutocompleteItem';
import { NgDropdownDirective } from '../dropdown/ng-dropdown.directive';
import { Subject } from 'rxjs';
var CompleterComponent = /** @class */ (function () {
    function CompleterComponent(_zone) {
        this._zone = _zone;
        this.cleared = new EventEmitter();
        this.selected = new EventEmitter();
        this.noResult = new EventEmitter();
        this.group = (/** @type {?} */ ({}));
        this._change = new Subject();
        this._items = {};
        this._completer = '';
        this._highlight = '';
        this._DOM = {
            notFound: (/** @type {?} */ (false)),
            empty: (/** @type {?} */ (false)),
            placeholder: (/** @type {?} */ (null)),
            selected: (/** @type {?} */ ('')),
            isLoading: (/** @type {?} */ (false))
        };
    }
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.ngOnInit = /**
     *
     * @return {?}
     */
    function () {
        var _this = this;
        this._zone.runOutsideAngular(function () {
            _this._change.pipe(debounceTime(300))
                .subscribe(function (value) {
                _this._zone.run(function () {
                    if (_this.group.async !== null) {
                        _this.RunAsyncFunction(value);
                    }
                    else {
                        _this.OnModelChange(value);
                    }
                });
            });
        });
        this.SetItems();
    };
    /**
     * Only used when completion is off.
     */
    /**
     * Only used when completion is off.
     * @return {?}
     */
    CompleterComponent.prototype.RegisterClick = /**
     * Only used when completion is off.
     * @return {?}
     */
    function () {
        if (!this.group.completion) {
            this.SwitchDropdownState();
        }
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.DropdownArray = /**
     *
     * @return {?}
     */
    function () {
        if (this.group.completion) {
            this.SwitchDropdownState();
        }
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.SwitchDropdownState = /**
     *
     * @return {?}
     */
    function () {
        if (this.dropdown._open) {
            this.CloseDropdown();
            return;
        }
        /**
         *
         */
        this.OpenDropdown();
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.CloseDropdown = /**
     *
     * @return {?}
     */
    function () {
        this.dropdown._open = false;
        /**
         *
         */
        this._DOM.placeholder = null;
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.OpenDropdown = /**
     *
     * @return {?}
     */
    function () {
        this.dropdown.Open();
        /**
         *
         */
        this._DOM.placeholder = null;
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.SetItems = /**
     *
     * @return {?}
     */
    function () {
        this._items = this.group.value;
        this.IsInitialEmpty();
    };
    /**
     *
     */
    /**
     *
     * @param {?} item
     * @return {?}
     */
    CompleterComponent.prototype.SelectItem = /**
     *
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var i;
        if (typeof item === 'string') {
            i = this._items[item];
            this._DOM.selected = item;
        }
        else {
            i = item;
            this._DOM.selected = SearchableAutoCompleteString(item.title, item.id);
        }
        this._completer = i.title;
        this._highlight = '';
        this.dropdown.Close(null, true);
        this.selected.emit({ group: { key: this.group.key }, item: i });
    };
    /**
     *
     */
    /**
     *
     * @param {?} value
     * @return {?}
     */
    CompleterComponent.prototype.RunAsyncFunction = /**
     *
     * @param {?} value
     * @return {?}
     */
    function (value) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var values;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this._completer = value;
                        this._highlight = value;
                        this._DOM.selected = null;
                        if (!(value.length === 0)) return [3 /*break*/, 1];
                        this.group.InitialValue();
                        this.ClearModel();
                        this.dropdown.Close('', true);
                        return [3 /*break*/, 3];
                    case 1:
                        if (!(value.length > this.group.searchLength)) return [3 /*break*/, 3];
                        this._DOM.isLoading = true;
                        return [4 /*yield*/, this.group.async(value)];
                    case 2:
                        values = _a.sent();
                        this.group.SetNewValue(values, this.group.keys.titleKey);
                        this._DOM.isLoading = false;
                        this._items = this.group.value;
                        this.EmptySearch(this._items, value);
                        // User has typed something now, results could be shown. We need to remove the "is-initial-empty" class.
                        this.IsInitialEmpty();
                        this.dropdown.Open();
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} value
     * @return {?}
     */
    CompleterComponent.prototype.OnModelChange = /**
     *
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this._completer = value;
        this._highlight = value;
        this._DOM.selected = null;
        if (value.length === 0) {
            this.ClearModel();
            this.dropdown.Close('', true);
        }
        else if (value.length > this.group.searchLength) {
            this.CompareItemsAndSet(value);
        }
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.ClearModel = /**
     *
     * @return {?}
     */
    function () {
        this._DOM.selected = null;
        this._DOM.notFound = false;
        this.cleared.emit(this.group.key);
    };
    /**
     *
     */
    /**
     *
     * @param {?} value
     * @return {?}
     */
    CompleterComponent.prototype.CompareItemsAndSet = /**
     *
     * @param {?} value
     * @return {?}
     */
    function (value) {
        /** @type {?} */
        var obj = {};
        for (var key in this.group.value) {
            if (ComparableAutoCompleteString(key).toLowerCase().indexOf(value.toLowerCase()) > -1) {
                obj[key] = this.group.value[key];
            }
        }
        this._items = obj;
        this.EmptySearch(this._items, value);
        // User has typed something now, results could be shown. We need to remove the "is-initial-empty" class.
        this.IsInitialEmpty();
        this.dropdown.Open();
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.OnInputBlurred = /**
     *
     * @return {?}
     */
    function () {
        if (!this.HasChosenValue()) {
            /**
             * Let component know completer input has been cleared -
             * this function shows the list again, also resets children, if chosen.
             */
            this.OnModelChange('');
        }
    };
    /**
     *
     */
    /**
     *
     * @param {?} item
     * @return {?}
     */
    CompleterComponent.prototype.OnHoverDropdownItem = /**
     *
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (typeof item == 'string') {
            this._DOM.placeholder = this._items[item];
            return;
        }
        if (item == null) {
            this._DOM.placeholder = null;
            return;
        }
        this._DOM.placeholder = item;
    };
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     * @return {?}
     */
    CompleterComponent.prototype.IsInitialEmpty = 
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     * @return {?}
     */
    function () {
        if (Object.keys(this._items).length === 0 && this._completer.length === 0) {
            this._DOM.empty = true;
            return;
        }
        this._DOM.empty = false;
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.HasChosenValue = /**
     *
     * @return {?}
     */
    function () {
        return this._DOM.selected !== null;
    };
    /**
     *
     */
    /**
     *
     * @param {?} obj
     * @param {?} query
     * @return {?}
     */
    CompleterComponent.prototype.EmptySearch = /**
     *
     * @param {?} obj
     * @param {?} query
     * @return {?}
     */
    function (obj, query) {
        if (Object.keys(obj).length > 0) {
            this._DOM.notFound = false;
            return;
        }
        this._DOM.notFound = true;
        this.noResult.emit({ group: { key: this.group.key }, query: query });
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    CompleterComponent.prototype.ClearValue = /**
     *
     * @return {?}
     */
    function () {
        this._completer = '';
        this._DOM.selected = null;
        this.group.InitialValue();
        this.IsInitialEmpty();
        /**
         *
         */
        this.selected.emit({ group: { key: this.group.key }, item: null });
    };
    CompleterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-completer',
                    template: "\n        <div #element class=\"ng-autocomplete-dropdown\"\n             [ngClass]=\"{'open': dropdown._open, 'is-loading': _DOM.isLoading, 'is-async': group.async !== null}\">\n\n            <!--GROUP: {{group.key}}-->\n\n            <div class=\"ng-autocomplete-inputs\" (click)=\"RegisterClick()\"\n                 [ngClass]=\"{'completion-off': !group.completion}\">\n                <span class=\"ng-autocomplete-placeholder\"\n                      *ngIf=\"_DOM.placeholder\">\n                  <ng-container *ngIf=\"group.placeholderValue\">\n                      <ng-template *ngTemplateOutlet=\"group.placeholderValue; context: {$implicit: _DOM.placeholder}\"></ng-template>\n                  </ng-container>\n                  <ng-template [ngIf]=\"!group.placeholderValue\">\n                      {{_DOM.placeholder.title}}\n                  </ng-template>\n                </span>\n                <input #input type=\"text\" [placeholder]=\"group.placeholder\" name=\"completer\" [(ngModel)]=\"_completer\"\n                       (ngModelChange)=\"_change.next($event);\"\n                       [value]=\"_completer\"\n                       autocomplete=\"off\"\n                       (click)=\"OpenDropdown()\"\n                       (focus)=\"OpenDropdown()\" class=\"ng-autocomplete-input\">\n\n                <span [ngClass]=\"{'open': dropdown._open}\" class=\"ng-autocomplete-dropdown-icon\"\n                      (click)=\"DropdownArray()\"></span>\n            </div>\n\n            <div class=\"ng-dropdown\" ngDropdown [list]=\"_items\" [element]=\"element\" [input]=\"input\"\n                 [ngClass]=\"{'is-initial-empty': _DOM.empty}\"\n                 [active]=\"_DOM.selected\" [key]=\"group.key\"\n                 [completion]=\"group.completion\"\n                 (hover)=\"OnHoverDropdownItem($event)\"\n                 (selected)=\"SelectItem($event)\"\n                 (closed)=\"OnInputBlurred()\"\n            >\n                <div *ngIf=\"_DOM.notFound && group.noResults\" class=\"dropdown-item no-results\">\n                    <ng-container *ngIf=\"group.noResults\">\n                        <ng-template *ngTemplateOutlet=\"group.noResults; context: {$implicit: _completer}\"></ng-template>\n                    </ng-container>\n                </div>\n\n                <div class=\"dropdown-item\" *ngFor=\"let item of _items | keys; let i = index\"\n                     (click)=\"SelectItem(_items[item])\">\n\n                    <ng-container *ngIf=\"group.dropdownValue\">\n                        <ng-template\n                            *ngTemplateOutlet=\"group.dropdownValue; context: {$implicit: _items[item], highlight: _items[item].title | highlight:_highlight}\"></ng-template>\n                    </ng-container>\n\n                    <div *ngIf=\"!group.dropdownValue\" [innerHTML]=\"_items[item].title | highlight:_highlight\"></div>\n                </div>\n            </div>\n        </div>",
                    styles: ["\n        .ng-autocomplete-inputs {\n            position: relative;\n        }\n\n        .ng-autocomplete-inputs.completion-off {\n            cursor: pointer;\n        }\n\n        .ng-autocomplete-inputs.completion-off input {\n            pointer-events: none;\n        }\n\n        .ng-autocomplete-placeholder {\n            pointer-events: none;\n        }\n\n        .ng-autocomplete-dropdown-icon {\n\n        }\n\n        .ng-autocomplete-dropdown .ng-dropdown {\n            display: none;\n        }\n\n        .ng-autocomplete-dropdown .ng-dropdown.is-empty {\n            display: none;\n        }\n\n        .ng-autocomplete-dropdown .ng-dropdown.open {\n            display: block;\n        }\n    "]
                }] }
    ];
    /** @nocollapse */
    CompleterComponent.ctorParameters = function () { return [
        { type: NgZone }
    ]; };
    CompleterComponent.propDecorators = {
        dropdown: [{ type: ViewChild, args: [NgDropdownDirective,] }],
        cleared: [{ type: Output }],
        selected: [{ type: Output }],
        noResult: [{ type: Output, args: ['no-result',] }],
        group: [{ type: Input }]
    };
    return CompleterComponent;
}());
export { CompleterComponent };
if (false) {
    /** @type {?} */
    CompleterComponent.prototype.dropdown;
    /** @type {?} */
    CompleterComponent.prototype.cleared;
    /** @type {?} */
    CompleterComponent.prototype.selected;
    /** @type {?} */
    CompleterComponent.prototype.noResult;
    /** @type {?} */
    CompleterComponent.prototype.group;
    /** @type {?} */
    CompleterComponent.prototype._change;
    /** @type {?} */
    CompleterComponent.prototype._items;
    /** @type {?} */
    CompleterComponent.prototype._completer;
    /** @type {?} */
    CompleterComponent.prototype._highlight;
    /** @type {?} */
    CompleterComponent.prototype._DOM;
    /**
     * @type {?}
     * @private
     */
    CompleterComponent.prototype._zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGxldGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLWF1dG8tY29tcGxldGUvIiwic291cmNlcyI6WyJsaWIvY29tcGxldGVyL2NvbXBsZXRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2hHLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQy9ELE9BQU8sRUFFSCw0QkFBNEIsRUFDNUIsNEJBQTRCLEVBRS9CLE1BQU0sNkJBQTZCLENBQUM7QUFDckMsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sbUNBQW1DLENBQUM7QUFFdEUsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUU3QjtJQWlISSw0QkFBb0IsS0FBYTtRQUFiLFVBQUssR0FBTCxLQUFLLENBQVE7UUFwQmhCLFlBQU8sR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUMzRCxhQUFRLEdBQTRDLElBQUksWUFBWSxFQUE2QixDQUFDO1FBQ3ZGLGFBQVEsR0FBZ0MsSUFBSSxZQUFZLEVBQWlCLENBQUM7UUFFdEYsVUFBSyxHQUFzQixtQkFBbUIsRUFBRSxFQUFBLENBQUM7UUFFakUsWUFBTyxHQUFvQixJQUFJLE9BQU8sRUFBVSxDQUFDO1FBQ2pELFdBQU0sR0FBMEMsRUFBRSxDQUFDO1FBQ25ELGVBQVUsR0FBVyxFQUFFLENBQUM7UUFDeEIsZUFBVSxHQUFXLEVBQUUsQ0FBQztRQUV4QixTQUFJLEdBQUc7WUFDSCxRQUFRLEVBQUUsbUJBQVMsS0FBSyxFQUFBO1lBQ3hCLEtBQUssRUFBRSxtQkFBUyxLQUFLLEVBQUE7WUFDckIsV0FBVyxFQUFFLG1C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LElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUUxQixJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0Qjs7V0FFRztRQUNILElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLEVBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDbkUsQ0FBQzs7Z0JBeFhKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsY0FBYztvQkFDeEIsUUFBUSxFQUFFLHE2RkFxREM7NkJBQ0YsNnNCQWdDUjtpQkFDSjs7OztnQkFyR3VDLE1BQU07OzsyQkF1R3pDLFNBQVMsU0FBQyxtQkFBbUI7MEJBRTdCLE1BQU07MkJBQ04sTUFBTTsyQkFDTixNQUFNLFNBQUMsV0FBVzt3QkFFbEIsS0FBSzs7SUF3UlYseUJBQUM7Q0FBQSxBQXpYRCxJQXlYQztTQS9SWSxrQkFBa0I7OztJQUMzQixzQ0FBcUU7O0lBRXJFLHFDQUE0RTs7SUFDNUUsc0NBQW1IOztJQUNuSCxzQ0FBc0c7O0lBRXRHLG1DQUFpRTs7SUFFakUscUNBQWlEOztJQUNqRCxvQ0FBbUQ7O0lBQ25ELHdDQUF3Qjs7SUFDeEIsd0NBQXdCOztJQUV4QixrQ0FPRTs7Ozs7SUFFVSxtQ0FBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2RlYm91bmNlVGltZX0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE5nWm9uZSwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0F1dG9jb21wbGV0ZUdyb3VwfSBmcm9tICcuLi9jbGFzc2VzL0F1dG9jb21wbGV0ZUdyb3VwJztcbmltcG9ydCB7XG4gICAgQXV0b2NvbXBsZXRlSXRlbSxcbiAgICBDb21wYXJhYmxlQXV0b0NvbXBsZXRlU3RyaW5nLFxuICAgIFNlYXJjaGFibGVBdXRvQ29tcGxldGVTdHJpbmcsXG4gICAgU3RyaXBwZWRBdXRvY29tcGxldGVHcm91cFxufSBmcm9tICcuLi9jbGFzc2VzL0F1dG9jb21wbGV0ZUl0ZW0nO1xuaW1wb3J0IHtOZ0Ryb3Bkb3duRGlyZWN0aXZlfSBmcm9tICcuLi9kcm9wZG93bi9uZy1kcm9wZG93bi5kaXJlY3RpdmUnO1xuaW1wb3J0IHtHcm91cE5vUmVzdWx0fSBmcm9tICcuLi91dGlscy91dGlscyc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25nLWNvbXBsZXRlcicsXG4gICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPGRpdiAjZWxlbWVudCBjbGFzcz1cIm5nLWF1dG9jb21wbGV0ZS1kcm9wZG93blwiXG4gICAgICAgICAgICAgW25nQ2xhc3NdPVwieydvcGVuJzogZHJvcGRvd24uX29wZW4sICdpcy1sb2FkaW5nJzogX0RPTS5pc0xvYWRpbmcsICdpcy1hc3luYyc6IGdyb3VwLmFzeW5jICE9PSBudWxsfVwiPlxuXG4gICAgICAgICAgICA8IS0tR1JPVVA6IHt7Z3JvdXAua2V5fX0tLT5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWF1dG9jb21wbGV0ZS1pbnB1dHNcIiAoY2xpY2spPVwiUmVnaXN0ZXJDbGljaygpXCJcbiAgICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwieydjb21wbGV0aW9uLW9mZic6ICFncm91cC5jb21wbGV0aW9ufVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibmctYXV0b2NvbXBsZXRlLXBsYWNlaG9sZGVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cIl9ET00ucGxhY2Vob2xkZXJcIj5cbiAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncm91cC5wbGFjZWhvbGRlclZhbHVlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlICpuZ1RlbXBsYXRlT3V0bGV0PVwiZ3JvdXAucGxhY2Vob2xkZXJWYWx1ZTsgY29udGV4dDogeyRpbXBsaWNpdDogX0RPTS5wbGFjZWhvbGRlcn1cIj48L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgW25nSWZdPVwiIWdyb3VwLnBsYWNlaG9sZGVyVmFsdWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICB7e19ET00ucGxhY2Vob2xkZXIudGl0bGV9fVxuICAgICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPGlucHV0ICNpbnB1dCB0eXBlPVwidGV4dFwiIFtwbGFjZWhvbGRlcl09XCJncm91cC5wbGFjZWhvbGRlclwiIG5hbWU9XCJjb21wbGV0ZXJcIiBbKG5nTW9kZWwpXT1cIl9jb21wbGV0ZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAobmdNb2RlbENoYW5nZSk9XCJfY2hhbmdlLm5leHQoJGV2ZW50KTtcIlxuICAgICAgICAgICAgICAgICAgICAgICBbdmFsdWVdPVwiX2NvbXBsZXRlclwiXG4gICAgICAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJPcGVuRHJvcGRvd24oKVwiXG4gICAgICAgICAgICAgICAgICAgICAgIChmb2N1cyk9XCJPcGVuRHJvcGRvd24oKVwiIGNsYXNzPVwibmctYXV0b2NvbXBsZXRlLWlucHV0XCI+XG5cbiAgICAgICAgICAgICAgICA8c3BhbiBbbmdDbGFzc109XCJ7J29wZW4nOiBkcm9wZG93bi5fb3Blbn1cIiBjbGFzcz1cIm5nLWF1dG9jb21wbGV0ZS1kcm9wZG93bi1pY29uXCJcbiAgICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwiRHJvcGRvd25BcnJheSgpXCI+PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJuZy1kcm9wZG93blwiIG5nRHJvcGRvd24gW2xpc3RdPVwiX2l0ZW1zXCIgW2VsZW1lbnRdPVwiZWxlbWVudFwiIFtpbnB1dF09XCJpbnB1dFwiXG4gICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cInsnaXMtaW5pdGlhbC1lbXB0eSc6IF9ET00uZW1wdHl9XCJcbiAgICAgICAgICAgICAgICAgW2FjdGl2ZV09XCJfRE9NLnNlbGVjdGVkXCIgW2tleV09XCJncm91cC5rZXlcIlxuICAgICAgICAgICAgICAgICBbY29tcGxldGlvbl09XCJncm91cC5jb21wbGV0aW9uXCJcbiAgICAgICAgICAgICAgICAgKGhvdmVyKT1cIk9uSG92ZXJEcm9wZG93bkl0ZW0oJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgIChzZWxlY3RlZCk9XCJTZWxlY3RJdGVtKCRldmVudClcIlxuICAgICAgICAgICAgICAgICAoY2xvc2VkKT1cIk9uSW5wdXRCbHVycmVkKClcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJfRE9NLm5vdEZvdW5kICYmIGdyb3VwLm5vUmVzdWx0c1wiIGNsYXNzPVwiZHJvcGRvd24taXRlbSBuby1yZXN1bHRzXCI+XG4gICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncm91cC5ub1Jlc3VsdHNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSAqbmdUZW1wbGF0ZU91dGxldD1cImdyb3VwLm5vUmVzdWx0czsgY29udGV4dDogeyRpbXBsaWNpdDogX2NvbXBsZXRlcn1cIj48L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgKm5nRm9yPVwibGV0IGl0ZW0gb2YgX2l0ZW1zIHwga2V5czsgbGV0IGkgPSBpbmRleFwiXG4gICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwiU2VsZWN0SXRlbShfaXRlbXNbaXRlbV0pXCI+XG5cbiAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImdyb3VwLmRyb3Bkb3duVmFsdWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwiZ3JvdXAuZHJvcGRvd25WYWx1ZTsgY29udGV4dDogeyRpbXBsaWNpdDogX2l0ZW1zW2l0ZW1dLCBoaWdobGlnaHQ6IF9pdGVtc1tpdGVtXS50aXRsZSB8IGhpZ2hsaWdodDpfaGlnaGxpZ2h0fVwiPjwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCIhZ3JvdXAuZHJvcGRvd25WYWx1ZVwiIFtpbm5lckhUTUxdPVwiX2l0ZW1zW2l0ZW1dLnRpdGxlIHwgaGlnaGxpZ2h0Ol9oaWdobGlnaHRcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5gLFxuICAgIHN0eWxlczogW2BcbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1pbnB1dHMge1xuICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1pbnB1dHMuY29tcGxldGlvbi1vZmYge1xuICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1pbnB1dHMuY29tcGxldGlvbi1vZmYgaW5wdXQge1xuICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAubmctYXV0b2NvbXBsZXRlLXBsYWNlaG9sZGVyIHtcbiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1kcm9wZG93bi1pY29uIHtcblxuICAgICAgICB9XG5cbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1kcm9wZG93biAubmctZHJvcGRvd24ge1xuICAgICAgICAgICAgZGlzcGxheTogbm9uZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5uZy1hdXRvY29tcGxldGUtZHJvcGRvd24gLm5nLWRyb3Bkb3duLmlzLWVtcHR5IHtcbiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAubmctYXV0b2NvbXBsZXRlLWRyb3Bkb3duIC5uZy1kcm9wZG93bi5vcGVuIHtcbiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgICB9XG4gICAgYF1cbn0pXG5leHBvcnQgY2xhc3MgQ29tcGxldGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBAVmlld0NoaWxkKE5nRHJvcGRvd25EaXJlY3RpdmUpIHB1YmxpYyBkcm9wZG93bjogTmdEcm9wZG93bkRpcmVjdGl2ZTtcblxuICAgIEBPdXRwdXQoKSBwdWJsaWMgY2xlYXJlZDogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgICBAT3V0cHV0KCkgcHVibGljIHNlbGVjdGVkOiBFdmVudEVtaXR0ZXI8U3RyaXBwZWRBdXRvY29tcGxldGVHcm91cD4gPSBuZXcgRXZlbnRFbWl0dGVyPFN0cmlwcGVkQXV0b2NvbXBsZXRlR3JvdXA+KCk7XG4gICAgQE91dHB1dCgnbm8tcmVzdWx0JykgcHVibGljIG5vUmVzdWx0OiBFdmVudEVtaXR0ZXI8R3JvdXBOb1Jlc3VsdD4gPSBuZXcgRXZlbnRFbWl0dGVyPEdyb3VwTm9SZXN1bHQ+KCk7XG5cbiAgICBASW5wdXQoKSBwdWJsaWMgZ3JvdXA6IEF1dG9jb21wbGV0ZUdyb3VwID0gPEF1dG9jb21wbGV0ZUdyb3VwPnt9O1xuXG4gICAgX2NoYW5nZTogU3ViamVjdDxzdHJpbmc+ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuICAgIF9pdGVtczogeyBbdmFsdWU6IHN0cmluZ106IEF1dG9jb21wbGV0ZUl0ZW0gfSA9IHt9O1xuICAgIF9jb21wbGV0ZXI6IHN0cmluZyA9ICcnO1xuICAgIF9oaWdobGlnaHQ6IHN0cmluZyA9ICcnO1xuXG4gICAgX0RPTSA9IHtcbiAgICAgICAgbm90Rm91bmQ6IDxib29sZWFuPmZhbHNlLFxuICAgICAgICBlbXB0eTogPGJvb2xlYW4+ZmFsc2UsXG4gICAgICAgIHBsYWNlaG9sZGVyOiA8QXV0b2NvbXBsZXRlSXRlbT5udWxsLFxuICAgICAgICBzZWxlY3RlZDogPHN0cmluZz4nJyxcbiAgICAgICAgaXNMb2FkaW5nOiA8Ym9vbGVhbj5mYWxzZVxuXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3pvbmU6IE5nWm9uZSkge1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuX3pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuXG4gICAgICAgICAgICB0aGlzLl9jaGFuZ2UucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMzAwKSlcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyb3VwLmFzeW5jICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5SdW5Bc3luY0Z1bmN0aW9uKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5Pbk1vZGVsQ2hhbmdlKHZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5TZXRJdGVtcygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9ubHkgdXNlZCB3aGVuIGNvbXBsZXRpb24gaXMgb2ZmLlxuICAgICAqL1xuICAgIFJlZ2lzdGVyQ2xpY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5ncm91cC5jb21wbGV0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLlN3aXRjaERyb3Bkb3duU3RhdGUoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBEcm9wZG93bkFycmF5KCkge1xuICAgICAgICBpZiAodGhpcy5ncm91cC5jb21wbGV0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLlN3aXRjaERyb3Bkb3duU3RhdGUoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTd2l0Y2hEcm9wZG93blN0YXRlKCkge1xuICAgICAgICBpZiAodGhpcy5kcm9wZG93bi5fb3Blbikge1xuICAgICAgICAgICAgdGhpcy5DbG9zZURyb3Bkb3duKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuT3BlbkRyb3Bkb3duKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIENsb3NlRHJvcGRvd24oKSB7XG4gICAgICAgIHRoaXMuZHJvcGRvd24uX29wZW4gPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX0RPTS5wbGFjZWhvbGRlciA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBPcGVuRHJvcGRvd24oKSB7XG4gICAgICAgIHRoaXMuZHJvcGRvd24uT3BlbigpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fRE9NLnBsYWNlaG9sZGVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFNldEl0ZW1zKCkge1xuICAgICAgICB0aGlzLl9pdGVtcyA9IHRoaXMuZ3JvdXAudmFsdWU7XG4gICAgICAgIHRoaXMuSXNJbml0aWFsRW1wdHkoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFNlbGVjdEl0ZW0oaXRlbTogQXV0b2NvbXBsZXRlSXRlbSB8IHN0cmluZykge1xuICAgICAgICBsZXQgaTogQXV0b2NvbXBsZXRlSXRlbTtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgaSA9IHRoaXMuX2l0ZW1zW2l0ZW1dO1xuICAgICAgICAgICAgdGhpcy5fRE9NLnNlbGVjdGVkID0gaXRlbTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGkgPSBpdGVtO1xuICAgICAgICAgICAgdGhpcy5fRE9NLnNlbGVjdGVkID0gU2VhcmNoYWJsZUF1dG9Db21wbGV0ZVN0cmluZyhpdGVtLnRpdGxlLCBpdGVtLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NvbXBsZXRlciA9IGkudGl0bGU7XG4gICAgICAgIHRoaXMuX2hpZ2hsaWdodCA9ICcnO1xuXG4gICAgICAgIHRoaXMuZHJvcGRvd24uQ2xvc2UobnVsbCwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7Z3JvdXA6IHtrZXk6IHRoaXMuZ3JvdXAua2V5fSwgaXRlbTogaX0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgYXN5bmMgUnVuQXN5bmNGdW5jdGlvbih2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX2NvbXBsZXRlciA9IHZhbHVlO1xuICAgICAgICB0aGlzLl9oaWdobGlnaHQgPSB2YWx1ZTtcblxuICAgICAgICB0aGlzLl9ET00uc2VsZWN0ZWQgPSBudWxsO1xuXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXAuSW5pdGlhbFZhbHVlKCk7XG4gICAgICAgICAgICB0aGlzLkNsZWFyTW9kZWwoKTtcblxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5DbG9zZSgnJywgdHJ1ZSlcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPiB0aGlzLmdyb3VwLnNlYXJjaExlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5fRE9NLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBhd2FpdCB0aGlzLmdyb3VwLmFzeW5jKHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXAuU2V0TmV3VmFsdWUodmFsdWVzLCB0aGlzLmdyb3VwLmtleXMudGl0bGVLZXkpO1xuXG4gICAgICAgICAgICB0aGlzLl9ET00uaXNMb2FkaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5ncm91cC52YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuRW1wdHlTZWFyY2godGhpcy5faXRlbXMsIHZhbHVlKTtcblxuICAgICAgICAgICAgLy8gVXNlciBoYXMgdHlwZWQgc29tZXRoaW5nIG5vdywgcmVzdWx0cyBjb3VsZCBiZSBzaG93bi4gV2UgbmVlZCB0byByZW1vdmUgdGhlIFwiaXMtaW5pdGlhbC1lbXB0eVwiIGNsYXNzLlxuICAgICAgICAgICAgdGhpcy5Jc0luaXRpYWxFbXB0eSgpO1xuICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5PcGVuKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIE9uTW9kZWxDaGFuZ2UodmFsdWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLl9jb21wbGV0ZXIgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5faGlnaGxpZ2h0ID0gdmFsdWU7XG5cbiAgICAgICAgdGhpcy5fRE9NLnNlbGVjdGVkID0gbnVsbDtcblxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLkNsZWFyTW9kZWwoKTtcblxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5DbG9zZSgnJywgdHJ1ZSlcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPiB0aGlzLmdyb3VwLnNlYXJjaExlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5Db21wYXJlSXRlbXNBbmRTZXQodmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBDbGVhck1vZGVsKCkge1xuICAgICAgICB0aGlzLl9ET00uc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgICB0aGlzLl9ET00ubm90Rm91bmQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmNsZWFyZWQuZW1pdCh0aGlzLmdyb3VwLmtleSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBDb21wYXJlSXRlbXNBbmRTZXQodmFsdWU6IHN0cmluZykge1xuICAgICAgICBjb25zdCBvYmogPSB7fTtcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHRoaXMuZ3JvdXAudmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChDb21wYXJhYmxlQXV0b0NvbXBsZXRlU3RyaW5nKGtleSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBvYmpba2V5XSA9IHRoaXMuZ3JvdXAudmFsdWVba2V5XVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faXRlbXMgPSBvYmo7XG4gICAgICAgIHRoaXMuRW1wdHlTZWFyY2godGhpcy5faXRlbXMsIHZhbHVlKTtcblxuICAgICAgICAvLyBVc2VyIGhhcyB0eXBlZCBzb21ldGhpbmcgbm93LCByZXN1bHRzIGNvdWxkIGJlIHNob3duLiBXZSBuZWVkIHRvIHJlbW92ZSB0aGUgXCJpcy1pbml0aWFsLWVtcHR5XCIgY2xhc3MuXG4gICAgICAgIHRoaXMuSXNJbml0aWFsRW1wdHkoKTtcbiAgICAgICAgdGhpcy5kcm9wZG93bi5PcGVuKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBPbklucHV0Qmx1cnJlZCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLkhhc0Nob3NlblZhbHVlKCkpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTGV0IGNvbXBvbmVudCBrbm93IGNvbXBsZXRlciBpbnB1dCBoYXMgYmVlbiBjbGVhcmVkIC1cbiAgICAgICAgICAgICAqIHRoaXMgZnVuY3Rpb24gc2hvd3MgdGhlIGxpc3QgYWdhaW4sIGFsc28gcmVzZXRzIGNoaWxkcmVuLCBpZiBjaG9zZW4uXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuT25Nb2RlbENoYW5nZSgnJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIE9uSG92ZXJEcm9wZG93bkl0ZW0oaXRlbTogQXV0b2NvbXBsZXRlSXRlbSB8IHN0cmluZykge1xuICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuX0RPTS5wbGFjZWhvbGRlciA9IHRoaXMuX2l0ZW1zW2l0ZW1dO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpdGVtID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX0RPTS5wbGFjZWhvbGRlciA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9ET00ucGxhY2Vob2xkZXIgPSBpdGVtO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyAhIFV0aWxzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gICAgSXNJbml0aWFsRW1wdHkoKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLl9pdGVtcykubGVuZ3RoID09PSAwICYmIHRoaXMuX2NvbXBsZXRlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX0RPTS5lbXB0eSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9ET00uZW1wdHkgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIEhhc0Nob3NlblZhbHVlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fRE9NLnNlbGVjdGVkICE9PSBudWxsXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBFbXB0eVNlYXJjaChvYmo6IE9iamVjdCwgcXVlcnk6IHN0cmluZykge1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl9ET00ubm90Rm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fRE9NLm5vdEZvdW5kID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ub1Jlc3VsdC5lbWl0KHtncm91cDoge2tleTogdGhpcy5ncm91cC5rZXl9LCBxdWVyeTogcXVlcnl9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgQ2xlYXJWYWx1ZSgpIHtcbiAgICAgICAgdGhpcy5fY29tcGxldGVyID0gJyc7XG4gICAgICAgIHRoaXMuX0RPTS5zZWxlY3RlZCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5ncm91cC5Jbml0aWFsVmFsdWUoKTtcbiAgICAgICAgdGhpcy5Jc0luaXRpYWxFbXB0eSgpO1xuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7Z3JvdXA6IHtrZXk6IHRoaXMuZ3JvdXAua2V5fSwgaXRlbTogbnVsbH0pO1xuICAgIH1cbn1cbiJdfQ==