/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { CompleterComponent } from './completer/completer.component';
import { ReturnStringArrayByID } from './utils/utils';
import { Subject } from 'rxjs';
var NgAutoCompleteComponent = /** @class */ (function () {
    function NgAutoCompleteComponent(cdr) {
        this.cdr = cdr;
        this.selected = new EventEmitter();
        this.noResult = new EventEmitter();
        this.group = [];
        this.key = '';
        this.classes = [];
        this._viewHasBeenInit = false;
        this._viewInitSubject = new Subject();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ngOnInit = /**
     *
     * @return {?}
     */
    function () {
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ngAfterViewChecked = /**
     *
     * @return {?}
     */
    function () {
        if (!this._viewHasBeenInit) {
            /** @type {?} */
            var el = this.init.nativeElement.querySelector('.after-view-init');
            if (window.getComputedStyle(el).length > 0) {
                this._viewHasBeenInit = true;
                this._viewInitSubject.next(true);
            }
        }
    };
    /**
     *
     */
    /**
     *
     * @param {?} selected
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ListenToSelected = /**
     *
     * @param {?} selected
     * @return {?}
     */
    function (selected) {
        this.selected.emit(selected);
        /**
         *
         */
        this.SetChildren(selected);
    };
    /**
     *
     */
    /**
     *
     * @param {?} group
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.NoResult = /**
     *
     * @param {?} group
     * @return {?}
     */
    function (group) {
        this.noResult.emit(group);
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.InputCleared = /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        this.group.forEach(function (group) {
            if (group.key === key || group.parent === key) {
                _this.ResetInput(group.key);
            }
        });
        /**
         * Items may have changed, need to te re-set list in completer components.
         */
        this.TriggerChange();
    };
    /**
     *
     */
    /**
     *
     * @param {?} selected
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetChildren = /**
     *
     * @param {?} selected
     * @return {?}
     */
    function (selected) {
        var _this = this;
        this.group.forEach(function (item) {
            if (item.parent == selected.group.key) {
                _this.ResetInput(item.key);
                /**
                 *
                 */
                if (selected.item !== null && typeof selected.item.children !== 'undefined') {
                    item.SetNewValue(selected.item.children, selected.group.keys.titleKey);
                }
            }
        });
        /**
         * Items may have changed, need to te re-set list in completer components.
         */
        this.TriggerChange();
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.TriggerChange = /**
     *
     * @return {?}
     */
    function () {
        this.completers.forEach(function (completer) {
            completer.SetItems();
        });
    };
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     */
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.GetInput = 
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return this.completers.reduce(function (result, completer) {
            if (completer.group.key === key) {
                result = completer;
            }
            return result;
        }, (/** @type {?} */ ({})));
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} f
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SubscribeInput = /**
     *
     * @param {?} key
     * @param {?} f
     * @return {?}
     */
    function (key, f) {
        var _this = this;
        if (this._viewHasBeenInit) {
            /** @type {?} */
            var completer = this.GetInput(key);
            /**
             *
             */
            f(completer);
            return;
        }
        this._viewInitSubject.subscribe(function (_bool) {
            /** @type {?} */
            var completer = _this.GetInput(key);
            setTimeout(function () {
                f(completer);
            });
            _this._viewInitSubject.unsubscribe();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ResetInput = /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        this.SubscribeInput(key, function (completer) {
            completer.ClearValue();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} values
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetValues = /**
     *
     * @param {?} key
     * @param {?} values
     * @return {?}
     */
    function (key, values) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group.SetValues(values);
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} type
     * @param {?} template
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetTemplate = /**
     *
     * @param {?} key
     * @param {?} type
     * @param {?} template
     * @return {?}
     */
    function (key, type, template) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group[type] = template;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} promise
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetAsync = /**
     *
     * @param {?} key
     * @param {?} promise
     * @return {?}
     */
    function (key, promise) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group.async = promise;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} id
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SelectItem = /**
     *
     * @param {?} key
     * @param {?} id
     * @return {?}
     */
    function (key, id) {
        this.SubscribeInput(key, function (completer) {
            Object.keys(completer._items).forEach(function (key) {
                /** @type {?} */
                var f = "_id_" + String(id);
                /** @type {?} */
                var c = key.substring(key.indexOf(f), key.length);
                if (f === c) {
                    completer.SelectItem(completer._items[key]);
                }
            });
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} ids
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.RemovableValues = /**
     *
     * @param {?} key
     * @param {?} ids
     * @return {?}
     */
    function (key, ids) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group.Removables(ReturnStringArrayByID(ids));
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ResetInputs = /**
     *
     * @return {?}
     */
    function () {
        var _this = this;
        this.group.forEach(function (item) {
            _this.ResetInput(item.key);
        });
    };
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     */
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @param {?} list
     * @return {?}
     */
    NgAutoCompleteComponent.FindCompleter = 
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @param {?} list
     * @return {?}
     */
    function (key, list) {
        /** @type {?} */
        var completer = list.filter(function (completer) {
            return key === completer.key;
        });
        if (typeof completer[0] !== 'undefined') {
            return completer[0];
        }
        return null;
    };
    NgAutoCompleteComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-auto-complete',
                    template: "\n        <div #init style=\"display: none;\"><span class=\"after-view-init\"></span></div>\n        <ng-completer [ngClass]=\"classes\" *ngFor=\"let item of group\" (cleared)=\"InputCleared($event)\"\n                      (no-result)=\"NoResult($event)\"\n                      (selected)=\"ListenToSelected($event)\"\n                      [group]=\"item\"></ng-completer>\n    "
                }] }
    ];
    /** @nocollapse */
    NgAutoCompleteComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    NgAutoCompleteComponent.propDecorators = {
        completers: [{ type: ViewChildren, args: [CompleterComponent,] }],
        init: [{ type: ViewChild, args: ['init',] }],
        selected: [{ type: Output }],
        noResult: [{ type: Output, args: ['no-result',] }],
        group: [{ type: Input }],
        key: [{ type: Input }],
        classes: [{ type: Input }]
    };
    return NgAutoCompleteComponent;
}());
export { NgAutoCompleteComponent };
if (false) {
    /** @type {?} */
    NgAutoCompleteComponent.prototype.completers;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.init;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.selected;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.noResult;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.group;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.key;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.classes;
    /** @type {?} */
    NgAutoCompleteComponent.prototype._viewHasBeenInit;
    /** @type {?} */
    NgAutoCompleteComponent.prototype._viewInitSubject;
    /**
     * @type {?}
     * @private
     */
    NgAutoCompleteComponent.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctYXV0by1jb21wbGV0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1hdXRvLWNvbXBsZXRlLyIsInNvdXJjZXMiOlsibGliL25nLWF1dG8tY29tcGxldGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxFQUdULFNBQVMsRUFDVCxZQUFZLEVBQ2YsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDbkUsT0FBTyxFQUFnQixxQkFBcUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuRSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRTdCO0lBd0JJLGlDQUFvQixHQUFzQjtRQUF0QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQVZ6QixhQUFRLEdBQTJDLElBQUksWUFBWSxFQUE0QixDQUFDO1FBQ3JGLGFBQVEsR0FBZ0MsSUFBSSxZQUFZLEVBQWlCLENBQUM7UUFFdEYsVUFBSyxHQUF3QixFQUFFLENBQUM7UUFDaEMsUUFBRyxHQUFXLEVBQUUsQ0FBQztRQUNqQixZQUFPLEdBQWEsRUFBRSxDQUFDO1FBRXZDLHFCQUFnQixHQUFZLEtBQUssQ0FBQztRQUNsQyxxQkFBZ0IsR0FBcUIsSUFBSSxPQUFPLEVBQVcsQ0FBQztJQUc1RCxDQUFDOzs7OztJQUVELDZDQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtJQUVsQyxDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0gsMENBQVE7Ozs7SUFBUjtJQUNBLENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSCxvREFBa0I7Ozs7SUFBbEI7UUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFOztnQkFDcEIsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENB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Q0wsS0FBSzs7SUE0UVYsOEJBQUM7Q0FBQSxBQS9SRCxJQStSQztTQXJSWSx1QkFBdUI7OztJQUNoQyw2Q0FBbUY7O0lBQ25GLHVDQUEyQzs7SUFFM0MsMkNBQWlIOztJQUNqSCwyQ0FBc0c7O0lBRXRHLHdDQUFnRDs7SUFDaEQsc0NBQWlDOztJQUNqQywwQ0FBdUM7O0lBRXZDLG1EQUFrQzs7SUFDbEMsbURBQTREOzs7OztJQUVoRCxzQ0FBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPbkluaXQsXG4gICAgT3V0cHV0LFxuICAgIFF1ZXJ5TGlzdCxcbiAgICBTaW1wbGVDaGFuZ2VzLFxuICAgIFRlbXBsYXRlUmVmLFxuICAgIFZpZXdDaGlsZCxcbiAgICBWaWV3Q2hpbGRyZW5cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0F1dG9jb21wbGV0ZUdyb3VwfSBmcm9tICcuL2NsYXNzZXMvQXV0b2NvbXBsZXRlR3JvdXAnO1xuaW1wb3J0IHtTZWxlY3RlZEF1dG9jb21wbGV0ZUl0ZW19IGZyb20gJy4vY2xhc3Nlcy90eXBpbmcnO1xuaW1wb3J0IHtDb21wbGV0ZXJDb21wb25lbnR9IGZyb20gJy4vY29tcGxldGVyL2NvbXBsZXRlci5jb21wb25lbnQnO1xuaW1wb3J0IHtHcm91cE5vUmVzdWx0LCBSZXR1cm5TdHJpbmdBcnJheUJ5SUR9IGZyb20gJy4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHtTdWJqZWN0fSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICduZy1hdXRvLWNvbXBsZXRlJyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8ZGl2ICNpbml0IHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj48c3BhbiBjbGFzcz1cImFmdGVyLXZpZXctaW5pdFwiPjwvc3Bhbj48L2Rpdj5cbiAgICAgICAgPG5nLWNvbXBsZXRlciBbbmdDbGFzc109XCJjbGFzc2VzXCIgKm5nRm9yPVwibGV0IGl0ZW0gb2YgZ3JvdXBcIiAoY2xlYXJlZCk9XCJJbnB1dENsZWFyZWQoJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgICAgICAgKG5vLXJlc3VsdCk9XCJOb1Jlc3VsdCgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgICAgICAoc2VsZWN0ZWQpPVwiTGlzdGVuVG9TZWxlY3RlZCgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgICAgICBbZ3JvdXBdPVwiaXRlbVwiPjwvbmctY29tcGxldGVyPlxuICAgIGAsXG59KVxuZXhwb3J0IGNsYXNzIE5nQXV0b0NvbXBsZXRlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBAVmlld0NoaWxkcmVuKENvbXBsZXRlckNvbXBvbmVudCkgcHVibGljIGNvbXBsZXRlcnM6IFF1ZXJ5TGlzdDxDb21wbGV0ZXJDb21wb25lbnQ+O1xuICAgIEBWaWV3Q2hpbGQoJ2luaXQnKSBwdWJsaWMgaW5pdDogRWxlbWVudFJlZjtcblxuICAgIEBPdXRwdXQoKSBwdWJsaWMgc2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxTZWxlY3RlZEF1dG9jb21wbGV0ZUl0ZW0+ID0gbmV3IEV2ZW50RW1pdHRlcjxTZWxlY3RlZEF1dG9jb21wbGV0ZUl0ZW0+KCk7XG4gICAgQE91dHB1dCgnbm8tcmVzdWx0JykgcHVibGljIG5vUmVzdWx0OiBFdmVudEVtaXR0ZXI8R3JvdXBOb1Jlc3VsdD4gPSBuZXcgRXZlbnRFbWl0dGVyPEdyb3VwTm9SZXN1bHQ+KCk7XG5cbiAgICBASW5wdXQoKSBwdWJsaWMgZ3JvdXA6IEF1dG9jb21wbGV0ZUdyb3VwW10gPSBbXTtcbiAgICBASW5wdXQoKSBwdWJsaWMga2V5OiBzdHJpbmcgPSAnJztcbiAgICBASW5wdXQoKSBwdWJsaWMgY2xhc3Nlczogc3RyaW5nW10gPSBbXTtcblxuICAgIF92aWV3SGFzQmVlbkluaXQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfdmlld0luaXRTdWJqZWN0OiBTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgbmdPbkluaXQoKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fdmlld0hhc0JlZW5Jbml0KSB7XG4gICAgICAgICAgICBsZXQgZWwgPSB0aGlzLmluaXQubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYWZ0ZXItdmlldy1pbml0Jyk7XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZpZXdIYXNCZWVuSW5pdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmlld0luaXRTdWJqZWN0Lm5leHQodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIExpc3RlblRvU2VsZWN0ZWQoc2VsZWN0ZWQ6IFNlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoc2VsZWN0ZWQpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5TZXRDaGlsZHJlbihzZWxlY3RlZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBOb1Jlc3VsdChncm91cDogR3JvdXBOb1Jlc3VsdCkge1xuICAgICAgICB0aGlzLm5vUmVzdWx0LmVtaXQoZ3JvdXApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgSW5wdXRDbGVhcmVkKGtleTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZ3JvdXAuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGlmIChncm91cC5rZXkgPT09IGtleSB8fCBncm91cC5wYXJlbnQgPT09IGtleSkge1xuICAgICAgICAgICAgICAgIHRoaXMuUmVzZXRJbnB1dChncm91cC5rZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgU2V0Q2hpbGRyZW4oc2VsZWN0ZWQ6IFNlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbSkge1xuICAgICAgICB0aGlzLmdyb3VwLmZvckVhY2goKGl0ZW0pID0+IHtcblxuICAgICAgICAgICAgaWYgKGl0ZW0ucGFyZW50ID09IHNlbGVjdGVkLmdyb3VwLmtleSkge1xuICAgICAgICAgICAgICAgIHRoaXMuUmVzZXRJbnB1dChpdGVtLmtleSk7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZC5pdGVtICE9PSBudWxsICYmIHR5cGVvZiBzZWxlY3RlZC5pdGVtLmNoaWxkcmVuICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLlNldE5ld1ZhbHVlKHNlbGVjdGVkLml0ZW0uY2hpbGRyZW4sIHNlbGVjdGVkLmdyb3VwLmtleXMudGl0bGVLZXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEl0ZW1zIG1heSBoYXZlIGNoYW5nZWQsIG5lZWQgdG8gdGUgcmUtc2V0IGxpc3QgaW4gY29tcGxldGVyIGNvbXBvbmVudHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLlRyaWdnZXJDaGFuZ2UoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFRyaWdnZXJDaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuY29tcGxldGVycy5mb3JFYWNoKChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgIGNvbXBsZXRlci5TZXRJdGVtcygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gISBVdGlscyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgR2V0SW5wdXQoa2V5OiBzdHJpbmcpOiBDb21wbGV0ZXJDb21wb25lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZXJzLnJlZHVjZSgocmVzdWx0LCBjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChjb21wbGV0ZXIuZ3JvdXAua2V5ID09PSBrZXkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBjb21wbGV0ZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sIDxDb21wbGV0ZXJDb21wb25lbnQ+e30pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgU3Vic2NyaWJlSW5wdXQoa2V5OiBzdHJpbmcsIGY6IChjb21wbGV0ZXI6IENvbXBsZXRlckNvbXBvbmVudCkgPT4gdm9pZCkge1xuICAgICAgICBpZiAodGhpcy5fdmlld0hhc0JlZW5Jbml0KSB7XG4gICAgICAgICAgICBsZXQgY29tcGxldGVyID0gdGhpcy5HZXRJbnB1dChrZXkpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGYoY29tcGxldGVyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3ZpZXdJbml0U3ViamVjdC5zdWJzY3JpYmUoKF9ib29sKSA9PiB7XG4gICAgICAgICAgICBsZXQgY29tcGxldGVyID0gdGhpcy5HZXRJbnB1dChrZXkpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgZihjb21wbGV0ZXIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3ZpZXdJbml0U3ViamVjdC51bnN1YnNjcmliZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFJlc2V0SW5wdXQoa2V5OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZXIuQ2xlYXJWYWx1ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgU2V0VmFsdWVzKGtleTogc3RyaW5nLCB2YWx1ZXM6IHsgaWQ/OiBzdHJpbmcgfCBudW1iZXI7IFt2YWx1ZTogc3RyaW5nXTogYW55IH1bXSkge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlci5ncm91cC5TZXRWYWx1ZXModmFsdWVzKTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEl0ZW1zIG1heSBoYXZlIGNoYW5nZWQsIG5lZWQgdG8gdGUgcmUtc2V0IGxpc3QgaW4gY29tcGxldGVyIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRUZW1wbGF0ZShrZXk6IHN0cmluZywgdHlwZTogJ25vUmVzdWx0cycgfCAncGxhY2Vob2xkZXJWYWx1ZScgfCAnZHJvcGRvd25WYWx1ZScsIHRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+KSB7XG4gICAgICAgIHRoaXMuU3Vic2NyaWJlSW5wdXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAoY29tcGxldGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVyLmdyb3VwW3R5cGVdID0gdGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBJdGVtcyBtYXkgaGF2ZSBjaGFuZ2VkLCBuZWVkIHRvIHRlIHJlLXNldCBsaXN0IGluIGNvbXBsZXRlciBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgU2V0QXN5bmMoa2V5OiBzdHJpbmcsIHByb21pc2U6IChzdHI6IHN0cmluZykgPT4gUHJvbWlzZTx7IGlkOiBzdHJpbmcgfCBudW1iZXI7IFt2YWx1ZTogc3RyaW5nXTogYW55IH1bXT4pIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZXIuZ3JvdXAuYXN5bmMgPSBwcm9taXNlO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXJDaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFNlbGVjdEl0ZW0oa2V5OiBzdHJpbmcsIGlkOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhjb21wbGV0ZXIuX2l0ZW1zKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGYgPSBgX2lkXyR7U3RyaW5nKGlkKX1gO1xuICAgICAgICAgICAgICAgICAgICBsZXQgYyA9IGtleS5zdWJzdHJpbmcoa2V5LmluZGV4T2YoZiksIGtleS5sZW5ndGgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmID09PSBjKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZXIuU2VsZWN0SXRlbShjb21wbGV0ZXIuX2l0ZW1zW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFJlbW92YWJsZVZhbHVlcyhrZXk6IHN0cmluZywgaWRzOiB7IGlkOiBzdHJpbmcgfCBudW1iZXIsIFt2YWx1ZTogc3RyaW5nXTogYW55IH1bXSkge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlci5ncm91cC5SZW1vdmFibGVzKFJldHVyblN0cmluZ0FycmF5QnlJRChpZHMpKTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEl0ZW1zIG1heSBoYXZlIGNoYW5nZWQsIG5lZWQgdG8gdGUgcmUtc2V0IGxpc3QgaW4gY29tcGxldGVyIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBSZXNldElucHV0cygpIHtcbiAgICAgICAgdGhpcy5ncm91cC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICB0aGlzLlJlc2V0SW5wdXQoaXRlbS5rZXkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gISBTdGF0aWMgKHV0aWxzKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgc3RhdGljIEZpbmRDb21wbGV0ZXIoa2V5OiBzdHJpbmcsIGxpc3Q6IFF1ZXJ5TGlzdDxOZ0F1dG9Db21wbGV0ZUNvbXBvbmVudD4pOiBOZ0F1dG9Db21wbGV0ZUNvbXBvbmVudCB7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRlciA9IGxpc3QuZmlsdGVyKChjb21wbGV0ZXI6IE5nQXV0b0NvbXBsZXRlQ29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ga2V5ID09PSBjb21wbGV0ZXIua2V5O1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodHlwZW9mIGNvbXBsZXRlclswXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZXJbMF07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG4iXX0=