/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { CompleterComponent } from './completer/completer.component';
import { ReturnStringArrayByID } from './utils/utils';
import { Subject } from 'rxjs';
export class NgAutoCompleteComponent {
    /**
     * @param {?} cdr
     */
    constructor(cdr) {
        this.cdr = cdr;
        this.selected = new EventEmitter();
        this.noResult = new EventEmitter();
        this.group = [];
        this.key = '';
        this.classes = [];
        this._viewHasBeenInit = false;
        this._viewInitSubject = new Subject();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     *
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     *
     * @return {?}
     */
    ngAfterViewChecked() {
        if (!this._viewHasBeenInit) {
            /** @type {?} */
            let el = this.init.nativeElement.querySelector('.after-view-init');
            if (window.getComputedStyle(el).length > 0) {
                this._viewHasBeenInit = true;
                this._viewInitSubject.next(true);
            }
        }
    }
    /**
     *
     * @param {?} selected
     * @return {?}
     */
    ListenToSelected(selected) {
        this.selected.emit(selected);
        /**
         *
         */
        this.SetChildren(selected);
    }
    /**
     *
     * @param {?} group
     * @return {?}
     */
    NoResult(group) {
        this.noResult.emit(group);
    }
    /**
     *
     * @param {?} key
     * @return {?}
     */
    InputCleared(key) {
        this.group.forEach((group) => {
            if (group.key === key || group.parent === key) {
                this.ResetInput(group.key);
            }
        });
        /**
         * Items may have changed, need to te re-set list in completer components.
         */
        this.TriggerChange();
    }
    /**
     *
     * @param {?} selected
     * @return {?}
     */
    SetChildren(selected) {
        this.group.forEach((item) => {
            if (item.parent == selected.group.key) {
                this.ResetInput(item.key);
                /**
                 *
                 */
                if (selected.item !== null && typeof selected.item.children !== 'undefined') {
                    item.SetNewValue(selected.item.children, selected.group.keys.titleKey);
                }
            }
        });
        /**
         * Items may have changed, need to te re-set list in completer components.
         */
        this.TriggerChange();
    }
    /**
     *
     * @return {?}
     */
    TriggerChange() {
        this.completers.forEach((completer) => {
            completer.SetItems();
        });
    }
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @return {?}
     */
    GetInput(key) {
        return this.completers.reduce((result, completer) => {
            if (completer.group.key === key) {
                result = completer;
            }
            return result;
        }, (/** @type {?} */ ({})));
    }
    /**
     *
     * @param {?} key
     * @param {?} f
     * @return {?}
     */
    SubscribeInput(key, f) {
        if (this._viewHasBeenInit) {
            /** @type {?} */
            let completer = this.GetInput(key);
            /**
             *
             */
            f(completer);
            return;
        }
        this._viewInitSubject.subscribe((_bool) => {
            /** @type {?} */
            let completer = this.GetInput(key);
            setTimeout(() => {
                f(completer);
            });
            this._viewInitSubject.unsubscribe();
        });
    }
    /**
     *
     * @param {?} key
     * @return {?}
     */
    ResetInput(key) {
        this.SubscribeInput(key, (completer) => {
            completer.ClearValue();
        });
    }
    /**
     *
     * @param {?} key
     * @param {?} values
     * @return {?}
     */
    SetValues(key, values) {
        this.SubscribeInput(key, (completer) => {
            completer.group.SetValues(values);
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            this.TriggerChange();
        });
    }
    /**
     *
     * @param {?} key
     * @param {?} type
     * @param {?} template
     * @return {?}
     */
    SetTemplate(key, type, template) {
        this.SubscribeInput(key, (completer) => {
            completer.group[type] = template;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            this.TriggerChange();
        });
    }
    /**
     *
     * @param {?} key
     * @param {?} promise
     * @return {?}
     */
    SetAsync(key, promise) {
        this.SubscribeInput(key, (completer) => {
            completer.group.async = promise;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            this.TriggerChange();
        });
    }
    /**
     *
     * @param {?} key
     * @param {?} id
     * @return {?}
     */
    SelectItem(key, id) {
        this.SubscribeInput(key, (completer) => {
            Object.keys(completer._items).forEach((key) => {
                /** @type {?} */
                let f = `_id_${String(id)}`;
                /** @type {?} */
                let c = key.substring(key.indexOf(f), key.length);
                if (f === c) {
                    completer.SelectItem(completer._items[key]);
                }
            });
        });
    }
    /**
     *
     * @param {?} key
     * @param {?} ids
     * @return {?}
     */
    RemovableValues(key, ids) {
        this.SubscribeInput(key, (completer) => {
            completer.group.Removables(ReturnStringArrayByID(ids));
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            this.TriggerChange();
        });
    }
    /**
     *
     * @return {?}
     */
    ResetInputs() {
        this.group.forEach((item) => {
            this.ResetInput(item.key);
        });
    }
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @param {?} list
     * @return {?}
     */
    static FindCompleter(key, list) {
        /** @type {?} */
        const completer = list.filter((completer) => {
            return key === completer.key;
        });
        if (typeof completer[0] !== 'undefined') {
            return completer[0];
        }
        return null;
    }
}
NgAutoCompleteComponent.decorators = [
    { type: Component, args: [{
                selector: 'ng-auto-complete',
                template: `
        <div #init style="display: none;"><span class="after-view-init"></span></div>
        <ng-completer [ngClass]="classes" *ngFor="let item of group" (cleared)="InputCleared($event)"
                      (no-result)="NoResult($event)"
                      (selected)="ListenToSelected($event)"
                      [group]="item"></ng-completer>
    `
            }] }
];
/** @nocollapse */
NgAutoCompleteComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
NgAutoCompleteComponent.propDecorators = {
    completers: [{ type: ViewChildren, args: [CompleterComponent,] }],
    init: [{ type: ViewChild, args: ['init',] }],
    selected: [{ type: Output }],
    noResult: [{ type: Output, args: ['no-result',] }],
    group: [{ type: Input }],
    key: [{ type: Input }],
    classes: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NgAutoCompleteComponent.prototype.completers;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.init;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.selected;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.noResult;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.group;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.key;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.classes;
    /** @type {?} */
    NgAutoCompleteComponent.prototype._viewHasBeenInit;
    /** @type {?} */
    NgAutoCompleteComponent.prototype._viewInitSubject;
    /**
     * @type {?}
     * @private
     */
    NgAutoCompleteComponent.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctYXV0by1jb21wbGV0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1hdXRvLWNvbXBsZXRlLyIsInNvdXJjZXMiOlsibGliL25nLWF1dG8tY29tcGxldGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxFQUdULFNBQVMsRUFDVCxZQUFZLEVBQ2YsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDbkUsT0FBTyxFQUFnQixxQkFBcUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuRSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBWTdCLE1BQU0sT0FBTyx1QkFBdUI7Ozs7SUFjaEMsWUFBb0IsR0FBc0I7UUFBdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFWekIsYUFBUSxHQUEyQyxJQUFJLFlBQVksRUFBNEIsQ0FBQztRQUNyRixhQUFRLEdBQWdDLElBQUksWUFBWSxFQUFpQixDQUFDO1FBRXRGLFVBQUssR0FBd0IsRUFBRSxDQUFDO1FBQ2hDLFFBQUcsR0FBVyxFQUFFLENBQUM7UUFDakIsWUFBTyxHQUFhLEVBQUUsQ0FBQztRQUV2QyxxQkFBZ0IsR0FBWSxLQUFLLENBQUM7UUFDbEMscUJBQWdCLEdBQXFCLElBQUksT0FBTyxFQUFXLENBQUM7SUFHNUQsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsT0FBc0I7SUFFbEMsQ0FBQzs7Ozs7SUFLRCxRQUFRO0lBQ1IsQ0FBQzs7Ozs7SUFLRCxrQkFBa0I7UUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFOztnQkFDcEIsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztZQUVsRSxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUN4QyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO2dCQUM3QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3BDO1NBQ0o7SUFDTCxDQUFDOzs7Ozs7SUFLRCxnQkFBZ0IsQ0FBQyxRQUFrQztRQUMvQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU3Qjs7V0FFRztRQUNILElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7Ozs7O0lBS0QsUUFBUSxDQUFDLEtBQW9CO1FBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlCLENBQUM7Ozs7OztJQUtELFlBQVksQ0FBQyxHQUFXO1FBQ3BCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDekIsSUFBSSxLQUFLLENBQUMsR0FBRyxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLEdBQUcsRUFBRTtnQkFDM0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDOUI7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVIOztXQUVHO1FBQ0gsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3pCLENBQUM7Ozs7OztJQUtELFdBQVcsQ0FBQyxRQUFrQztRQUMxQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBRXhCLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRTtnQkFDbkMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBRTFCOzttQkFFRztnQkFDSCxJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEtBQUssV0FBVyxFQUFFO29CQUN6RSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUMxRTthQUNKO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSDs7V0FFRztRQUNILElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDOzs7OztJQUtELGFBQWE7UUFDVCxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ2xDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Ozs7Ozs7OztJQVNELFFBQVEsQ0FBQyxHQUFXO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLEVBQUU7WUFDaEQsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSyxHQUFHLEVBQUU7Z0JBQzdCLE1BQU0sR0FBRyxTQUFTLENBQUM7YUFDdEI7WUFFRCxPQUFPLE1BQU0sQ0FBQztRQUNsQixDQUFDLEVBQUUsbUJBQW9CLEVBQUUsRUFBQSxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7Ozs7OztJQUtELGNBQWMsQ0FBQyxHQUFXLEVBQUUsQ0FBMEM7UUFDbEUsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7O2dCQUNuQixTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUM7WUFFbEM7O2VBRUc7WUFDSCxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDYixPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7O2dCQUNsQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUM7WUFDbEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDWixDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDakIsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDOzs7Ozs7SUFLRCxVQUFVLENBQUMsR0FBVztRQUNsQixJQUFJLENBQUMsY0FBYyxDQUNmLEdBQUcsRUFDSCxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ1YsU0FBUyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzNCLENBQUMsQ0FDSixDQUFDO0lBQ04sQ0FBQzs7Ozs7OztJQUtELFNBQVMsQ0FBQyxHQUFXLEVBQUUsTUFBd0Q7UUFDM0UsSUFBSSxDQUFDLGNBQWMsQ0FDZixHQUFHLEVBQ0gsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNWLFNBQVMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRWxDOztlQUVHO1lBQ0gsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pCLENBQUMsQ0FDSixDQUFDO0lBQ04sQ0FBQzs7Ozs7Ozs7SUFLRCxXQUFXLENBQUMsR0FBVyxFQUFFLElBQXdELEVBQUUsUUFBMEI7UUFDekcsSUFBSSxDQUFDLGNBQWMsQ0FDZixHQUFHLEVBQ0gsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNWLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDO1lBRWpDOztlQUVHO1lBQ0gsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pCLENBQUMsQ0FDSixDQUFDO0lBQ04sQ0FBQzs7Ozs7OztJQUtELFFBQVEsQ0FBQyxHQUFXLEVBQUUsT0FBa0Y7UUFDcEcsSUFBSSxDQUFDLGNBQWMsQ0FDZixHQUFHLEVBQ0gsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNWLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQztZQUVoQzs7ZUFFRztZQUNILElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QixDQUFDLENBQ0osQ0FBQztJQUNOLENBQUM7Ozs7Ozs7SUFLRCxVQUFVLENBQUMsR0FBVyxFQUFFLEVBQW1CO1FBQ3ZDLElBQUksQ0FBQyxjQUFjLENBQ2YsR0FBRyxFQUNILENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDVixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTs7b0JBQ3RDLENBQUMsR0FBRyxPQUFPLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRTs7b0JBQ3ZCLENBQUMsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQztnQkFFakQsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUNULFNBQVMsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2lCQUMvQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBRVAsQ0FBQyxDQUNKLENBQUM7SUFDTixDQUFDOzs7Ozs7O0lBS0QsZUFBZSxDQUFDLEdBQVcsRUFBRSxHQUFvRDtRQUM3RSxJQUFJLENBQUMsY0FBYyxDQUNmLEdBQUcsRUFDSCxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ1YsU0FBUyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUV2RDs7ZUFFRztZQUNILElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QixDQUFDLENBQ0osQ0FBQztJQUNOLENBQUM7Ozs7O0lBS0QsV0FBVztRQUNQLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDeEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDOzs7Ozs7Ozs7O0lBU0QsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUFXLEVBQUUsSUFBd0M7O2NBQ2hFLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBa0MsRUFBRSxFQUFFO1lBQ2pFLE9BQU8sR0FBRyxLQUFLLFNBQVMsQ0FBQyxHQUFHLENBQUM7UUFDakMsQ0FBQyxDQUFDO1FBRUYsSUFBSSxPQUFPLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxXQUFXLEVBQUU7WUFDckMsT0FBTyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDOzs7WUE5UkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxrQkFBa0I7Z0JBQzVCLFFBQVEsRUFBRTs7Ozs7O0tBTVQ7YUFDSjs7OztZQTVCRyxpQkFBaUI7Ozt5QkE4QmhCLFlBQVksU0FBQyxrQkFBa0I7bUJBQy9CLFNBQVMsU0FBQyxNQUFNO3VCQUVoQixNQUFNO3VCQUNOLE1BQU0sU0FBQyxXQUFXO29CQUVsQixLQUFLO2tCQUNMLEtBQUs7c0JBQ0wsS0FBSzs7OztJQVJOLDZDQUFtRjs7SUFDbkYsdUNBQTJDOztJQUUzQywyQ0FBaUg7O0lBQ2pILDJDQUFzRzs7SUFFdEcsd0NBQWdEOztJQUNoRCxzQ0FBaUM7O0lBQ2pDLDBDQUF1Qzs7SUFFdkMsbURBQWtDOztJQUNsQyxtREFBNEQ7Ozs7O0lBRWhELHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIElucHV0LFxuICAgIE9uSW5pdCxcbiAgICBPdXRwdXQsXG4gICAgUXVlcnlMaXN0LFxuICAgIFNpbXBsZUNoYW5nZXMsXG4gICAgVGVtcGxhdGVSZWYsXG4gICAgVmlld0NoaWxkLFxuICAgIFZpZXdDaGlsZHJlblxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QXV0b2NvbXBsZXRlR3JvdXB9IGZyb20gJy4vY2xhc3Nlcy9BdXRvY29tcGxldGVHcm91cCc7XG5pbXBvcnQge1NlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbX0gZnJvbSAnLi9jbGFzc2VzL3R5cGluZyc7XG5pbXBvcnQge0NvbXBsZXRlckNvbXBvbmVudH0gZnJvbSAnLi9jb21wbGV0ZXIvY29tcGxldGVyLmNvbXBvbmVudCc7XG5pbXBvcnQge0dyb3VwTm9SZXN1bHQsIFJldHVyblN0cmluZ0FycmF5QnlJRH0gZnJvbSAnLi91dGlscy91dGlscyc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25nLWF1dG8tY29tcGxldGUnLFxuICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxkaXYgI2luaXQgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjxzcGFuIGNsYXNzPVwiYWZ0ZXItdmlldy1pbml0XCI+PC9zcGFuPjwvZGl2PlxuICAgICAgICA8bmctY29tcGxldGVyIFtuZ0NsYXNzXT1cImNsYXNzZXNcIiAqbmdGb3I9XCJsZXQgaXRlbSBvZiBncm91cFwiIChjbGVhcmVkKT1cIklucHV0Q2xlYXJlZCgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgICAgICAobm8tcmVzdWx0KT1cIk5vUmVzdWx0KCRldmVudClcIlxuICAgICAgICAgICAgICAgICAgICAgIChzZWxlY3RlZCk9XCJMaXN0ZW5Ub1NlbGVjdGVkKCRldmVudClcIlxuICAgICAgICAgICAgICAgICAgICAgIFtncm91cF09XCJpdGVtXCI+PC9uZy1jb21wbGV0ZXI+XG4gICAgYCxcbn0pXG5leHBvcnQgY2xhc3MgTmdBdXRvQ29tcGxldGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIEBWaWV3Q2hpbGRyZW4oQ29tcGxldGVyQ29tcG9uZW50KSBwdWJsaWMgY29tcGxldGVyczogUXVlcnlMaXN0PENvbXBsZXRlckNvbXBvbmVudD47XG4gICAgQFZpZXdDaGlsZCgnaW5pdCcpIHB1YmxpYyBpbml0OiBFbGVtZW50UmVmO1xuXG4gICAgQE91dHB1dCgpIHB1YmxpYyBzZWxlY3RlZDogRXZlbnRFbWl0dGVyPFNlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbT4gPSBuZXcgRXZlbnRFbWl0dGVyPFNlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbT4oKTtcbiAgICBAT3V0cHV0KCduby1yZXN1bHQnKSBwdWJsaWMgbm9SZXN1bHQ6IEV2ZW50RW1pdHRlcjxHcm91cE5vUmVzdWx0PiA9IG5ldyBFdmVudEVtaXR0ZXI8R3JvdXBOb1Jlc3VsdD4oKTtcblxuICAgIEBJbnB1dCgpIHB1YmxpYyBncm91cDogQXV0b2NvbXBsZXRlR3JvdXBbXSA9IFtdO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBrZXk6IHN0cmluZyA9ICcnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBjbGFzc2VzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgX3ZpZXdIYXNCZWVuSW5pdDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIF92aWV3SW5pdFN1YmplY3Q6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBuZ09uSW5pdCgpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl92aWV3SGFzQmVlbkluaXQpIHtcbiAgICAgICAgICAgIGxldCBlbCA9IHRoaXMuaW5pdC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZnRlci12aWV3LWluaXQnKTtcblxuICAgICAgICAgICAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmlld0hhc0JlZW5Jbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLl92aWV3SW5pdFN1YmplY3QubmV4dCh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgTGlzdGVuVG9TZWxlY3RlZChzZWxlY3RlZDogU2VsZWN0ZWRBdXRvY29tcGxldGVJdGVtKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChzZWxlY3RlZCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLlNldENoaWxkcmVuKHNlbGVjdGVkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIE5vUmVzdWx0KGdyb3VwOiBHcm91cE5vUmVzdWx0KSB7XG4gICAgICAgIHRoaXMubm9SZXN1bHQuZW1pdChncm91cCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBJbnB1dENsZWFyZWQoa2V5OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5ncm91cC5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgaWYgKGdyb3VwLmtleSA9PT0ga2V5IHx8IGdyb3VwLnBhcmVudCA9PT0ga2V5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5SZXNldElucHV0KGdyb3VwLmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJdGVtcyBtYXkgaGF2ZSBjaGFuZ2VkLCBuZWVkIHRvIHRlIHJlLXNldCBsaXN0IGluIGNvbXBsZXRlciBjb21wb25lbnRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRDaGlsZHJlbihzZWxlY3RlZDogU2VsZWN0ZWRBdXRvY29tcGxldGVJdGVtKSB7XG4gICAgICAgIHRoaXMuZ3JvdXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXG4gICAgICAgICAgICBpZiAoaXRlbS5wYXJlbnQgPT0gc2VsZWN0ZWQuZ3JvdXAua2V5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5SZXNldElucHV0KGl0ZW0ua2V5KTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkLml0ZW0gIT09IG51bGwgJiYgdHlwZW9mIHNlbGVjdGVkLml0ZW0uY2hpbGRyZW4gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uU2V0TmV3VmFsdWUoc2VsZWN0ZWQuaXRlbS5jaGlsZHJlbiwgc2VsZWN0ZWQuZ3JvdXAua2V5cy50aXRsZUtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgVHJpZ2dlckNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZXJzLmZvckVhY2goKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgY29tcGxldGVyLlNldEl0ZW1zKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyAhIFV0aWxzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBHZXRJbnB1dChrZXk6IHN0cmluZyk6IENvbXBsZXRlckNvbXBvbmVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlcnMucmVkdWNlKChyZXN1bHQsIGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbXBsZXRlci5ncm91cC5rZXkgPT09IGtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbXBsZXRlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSwgPENvbXBsZXRlckNvbXBvbmVudD57fSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTdWJzY3JpYmVJbnB1dChrZXk6IHN0cmluZywgZjogKGNvbXBsZXRlcjogQ29tcGxldGVyQ29tcG9uZW50KSA9PiB2b2lkKSB7XG4gICAgICAgIGlmICh0aGlzLl92aWV3SGFzQmVlbkluaXQpIHtcbiAgICAgICAgICAgIGxldCBjb21wbGV0ZXIgPSB0aGlzLkdldElucHV0KGtleSk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZihjb21wbGV0ZXIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fdmlld0luaXRTdWJqZWN0LnN1YnNjcmliZSgoX2Jvb2wpID0+IHtcbiAgICAgICAgICAgIGxldCBjb21wbGV0ZXIgPSB0aGlzLkdldElucHV0KGtleSk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBmKGNvbXBsZXRlcik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fdmlld0luaXRTdWJqZWN0LnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgUmVzZXRJbnB1dChrZXk6IHN0cmluZykge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlci5DbGVhclZhbHVlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRWYWx1ZXMoa2V5OiBzdHJpbmcsIHZhbHVlczogeyBpZD86IHN0cmluZyB8IG51bWJlcjsgW3ZhbHVlOiBzdHJpbmddOiBhbnkgfVtdKSB7XG4gICAgICAgIHRoaXMuU3Vic2NyaWJlSW5wdXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAoY29tcGxldGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVyLmdyb3VwLlNldFZhbHVlcyh2YWx1ZXMpO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXJDaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFNldFRlbXBsYXRlKGtleTogc3RyaW5nLCB0eXBlOiAnbm9SZXN1bHRzJyB8ICdwbGFjZWhvbGRlclZhbHVlJyB8ICdkcm9wZG93blZhbHVlJywgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4pIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZXIuZ3JvdXBbdHlwZV0gPSB0ZW1wbGF0ZTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEl0ZW1zIG1heSBoYXZlIGNoYW5nZWQsIG5lZWQgdG8gdGUgcmUtc2V0IGxpc3QgaW4gY29tcGxldGVyIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRBc3luYyhrZXk6IHN0cmluZywgcHJvbWlzZTogKHN0cjogc3RyaW5nKSA9PiBQcm9taXNlPHsgaWQ6IHN0cmluZyB8IG51bWJlcjsgW3ZhbHVlOiBzdHJpbmddOiBhbnkgfVtdPikge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlci5ncm91cC5hc3luYyA9IHByb21pc2U7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBJdGVtcyBtYXkgaGF2ZSBjaGFuZ2VkLCBuZWVkIHRvIHRlIHJlLXNldCBsaXN0IGluIGNvbXBsZXRlciBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgU2VsZWN0SXRlbShrZXk6IHN0cmluZywgaWQ6IHN0cmluZyB8IG51bWJlcikge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGNvbXBsZXRlci5faXRlbXMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZiA9IGBfaWRfJHtTdHJpbmcoaWQpfWA7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjID0ga2V5LnN1YnN0cmluZyhrZXkuaW5kZXhPZihmKSwga2V5Lmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IGMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlci5TZWxlY3RJdGVtKGNvbXBsZXRlci5faXRlbXNba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgUmVtb3ZhYmxlVmFsdWVzKGtleTogc3RyaW5nLCBpZHM6IHsgaWQ6IHN0cmluZyB8IG51bWJlciwgW3ZhbHVlOiBzdHJpbmddOiBhbnkgfVtdKSB7XG4gICAgICAgIHRoaXMuU3Vic2NyaWJlSW5wdXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAoY29tcGxldGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVyLmdyb3VwLlJlbW92YWJsZXMoUmV0dXJuU3RyaW5nQXJyYXlCeUlEKGlkcykpO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXJDaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFJlc2V0SW5wdXRzKCkge1xuICAgICAgICB0aGlzLmdyb3VwLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuUmVzZXRJbnB1dChpdGVtLmtleSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyAhIFN0YXRpYyAodXRpbHMpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBzdGF0aWMgRmluZENvbXBsZXRlcihrZXk6IHN0cmluZywgbGlzdDogUXVlcnlMaXN0PE5nQXV0b0NvbXBsZXRlQ29tcG9uZW50Pik6IE5nQXV0b0NvbXBsZXRlQ29tcG9uZW50IHtcbiAgICAgICAgY29uc3QgY29tcGxldGVyID0gbGlzdC5maWx0ZXIoKGNvbXBsZXRlcjogTmdBdXRvQ29tcGxldGVDb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBrZXkgPT09IGNvbXBsZXRlci5rZXk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0eXBlb2YgY29tcGxldGVyWzBdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBsZXRlclswXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbiJdfQ==